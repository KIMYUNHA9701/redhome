<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssangyong.redhome.dao.ProductMapper">

    <select id="selectAllProduct" resultType="com.ssangyong.redhome.bean.Product">
        SELECT * FROM PRODUCT ORDER BY product_num
    </select>

    <select id="selectCateProduct" parameterType="java.util.Map" resultType="com.ssangyong.redhome.bean.Product">
        SELECT * FROM PRODUCT
        <if test="c_num != null or p_name != null">
            WHERE
            <if test="c_num != null and c_num != 0">
                PRODUCT_CATEGORY_NUM = #{c_num}
            </if>
            <if test="p_name != null">
                PRODUCT_NAME LIKE '%${p_name}%'
            </if>
        </if>

        <if test="sort != null">
            ORDER BY
            <choose>
                <when test='sort.equals("best")'>PRODUCT_QUANTITY_SOLD DESC</when>
                <when test='sort.equals("new")'>PRODUCT_NUM DESC</when>
                <when test='sort.equals("high")'>PRODUCT_PRICE DESC</when>
                <when test='sort.equals("low")'>PRODUCT_PRICE</when>
            </choose>
        </if>
    </select>

    <select id="selectAvgReview" parameterType="Integer" resultType="com.ssangyong.redhome.bean.Review_avg">
        SELECT PRODUCT_NUM, NVL(AVG(REVIEW_GRADE),0) AS GRADE_AVG, NVL(COUNT(*),0) AS REVIEW_CNT
        FROM REVIEW
        WHERE PRODUCT_NUM = #{VALUE}
        GROUP BY PRODUCT_NUM
    </select>

    <select id="selectReview" parameterType="Integer" resultType="com.ssangyong.redhome.bean.Review">
        SELECT *
        FROM REVIEW
        WHERE PRODUCT_NUM = #{VALUE}
    </select>

    <select id="selectSaleList" resultType="com.ssangyong.redhome.bean.Product_sale_List">
        select p.*, ps.sale_rate
        from product p , product_sale ps
        where p.product_num in (select product_num from product_sale) and p.product_num = ps.product_num
    </select>

    <select id="selectSaleOne" parameterType="Integer" resultType="com.ssangyong.redhome.bean.Product_sale">
        SELECT *
        FROM PRODUCT_SALE
        WHERE PRODUCT_NUM = #{VALUE}
    </select>

    <select id="selectSaleProduct" parameterType="Integer" resultType="com.ssangyong.redhome.bean.Product">
        SELECT *
        FROM PRODUCT
        WHERE product_num = ${VALUE}
    </select>

    <select id="selectProduct" parameterType="Integer" resultType="com.ssangyong.redhome.bean.Product">
        SELECT * FROM PRODUCT
        WHERE product_num = #{VALUE}
    </select>

    <insert id="insertProduct" parameterType="com.ssangyong.redhome.bean.Product">
        INSERT INTO PRODUCT(PRODUCT_NUM, PRODUCT_NAME, PRODUCT_IMG, PRODUCT_PRICE, PRODUCT_QUANTITY,
        PRODUCT_QUANTITY_SOLD, PRODUCT_TYPE_NUM, PRODUCT_CATEGORY_NUM)
        VALUES(#{product_num}, #{product_name}, #{product_img}, #{product_price}, 10, 0, #{product_type_num},
        #{product_category_num})
    </insert>

    <delete id="deleteProduct" parameterType="Integer">
        DELETE FROM PRODUCT WHERE PRODUCT_NUM = #{VALUE}
    </delete>

    <update id="updateProduct" parameterType="java.util.Map">
        UPDATE PRODUCT
        SET PRODUCT_NAME = #{product_name},
            PRODUCT_IMG = #{product_img},
            PRODUCT_PRICE = #{product_price},
            PRODUCT_QUANTITY = #{product_quantity},
            PRODUCT_QUANTITY_SOLD = #{product_quantity_sold},
            PRODUCT_TYPE_NUM = #{product_type_num},
            PRODUCT_CATEGORY_NUM = #{product_category_num}
        WHERE product_num = #{no}
    </update>
</mapper>